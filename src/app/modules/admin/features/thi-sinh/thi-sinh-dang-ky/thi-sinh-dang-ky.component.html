<ng-container
  *ngIf="userInfo && userInfo.cccd_img_truoc && userInfo.anh_chandung  && userInfo.status === 0,else notStatus">

  <ng-container [ngSwitch]="ngType">
    <ng-container *ngSwitchCase="-1">
      <div class="w-100 d-flex flex-column justify-content-center align-items-center" style="height:calc(100vh - 90px)">
        <!--      <div class="w-100 d-flex flex-column justify-content-center align-items-center" style="height:100%">-->
        <div>
          <i class="pi pi-spin pi-spinner" style="font-size: 4rem"></i>
        </div>
        <div style="padding:12px;font-size: 16px;"> Đang chờ thanh toán</div>

        <button pRipple pButton icon="pi pi-sign-out" class="p-button-raised p-button-warning"
                label="Truy cập kết quả đăng ký" (click)="btnchecksite()"></button>
      </div>
    </ng-container>
    <ng-container *ngSwitchCase="1">
      <!--      <div class="w-100 d-flex flex-column justify-content-center align-items-center" style="height:calc(100vh - 90px)">-->
      <div class="w-100 d-flex flex-column justify-content-center align-items-center" style="height:calc(100vh - 90px)">
        <div>
          <i class="pi pi-check-circle p-button-success" style="font-size: 4rem;color:#1baf08;"></i>
        </div>
        <div style="padding:12px;font-size: 16px;"> Thanh toán thành công</div>

        <button pRipple pButton icon="pi pi-sign-out" class="p-button-raised p-button-success"
                label="Truy cập kết quả đăng ký" (click)="btnchecksite()"></button>
      </div>
    </ng-container>
    <ng-container *ngSwitchCase="0">
      <div class="ovic-container overflow-hidden overflow-x-auto overflow-y-auto "
           style="height:calc(100vh - 60px - 30px)">
        <div class="ovic-container " style="height:100%">
          <div class="thpt-form-data ovic-side-navigation-content --no-footer overflow-hidden overflow-y-auto">
            <!--  Lưu ý          -->
            <div class="row row-cols-1 p-2">
              <div class="col-12">
                <div class="thpt-note">
                  <div class="thpt-note-header" style="color:red;">Lưu ý:</div>
                  <div class="thpt-note-body">
                    <!--                <p>- Bạn có thể chọn nhiều môn thi trong một lần đăng ký của từng đợt thi.</p>-->
                    <!--                    <p>- Lệ phí thi với mỗi cấp độ là-->
                    <!--                      <strong>{{ (lephithiData ? lephithiData['value'] : 0) | numberToVndCurrencuy }}</strong> / 1 cấp độ .</p>-->
                    <p>- Sau khi thí sinh hoàn tất thao tác đăng ký, cần thực hiện thanh toán lệ phí thi ngay để giữ
                      chỗ. </p>
                    <p>- Sau khi kết thúc đợt đăng ký thí sinh không thanh toán lệ phí thi, hệ thống sẽ hủy kết quả đăng
                      ký. </p>
                    <p>- Để thực hiện đăng ký nhiều cấp độ vui lòng đăng ký từng cấp độ và thực hiện thanh toán. </p>
                    <p>- Vui lòng thực hiện thêm thông tin cá nhân sau khi thanh toán thành công. </p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Form đăng ký         -->
            <div class="form-create">
              <div class="head">
                Thông tin đăng ký dự thi
              </div>
              <div class="ovic-vertical__inputs ovic-vertical__inputs--layout-2">
                <form [formGroup]="formSave" autocomplete="off">
                  <div class="row ">
                    <div class="col-6 col-md-12 col-xl-6">
                      <div class="form-row">
                        <label>Đợt thi <span class="ovic-mark">*</span></label>
                        <ovic-dropdown class="w-100" [options]="keHoachThi_dangky" [optionLabel]="'title'"
                                       placeholder="Chọn đợt thi" [filter]="true"
                                       [filterBy]="'title'" optionId="id" [formField]="f['kehoach_id']"
                                       (onChange)="selectKehoachthi($event)"
                        ></ovic-dropdown>
                      </div>
                    </div>
                    <div class="col col-md-12 col-xl-6">
                      <div class="form-row">
                        <label>Điểm dự thi <span class="ovic-mark">*</span></label>
                        <ovic-dropdown class="w-100" [options]="kehoachDiemduthi" [optionLabel]="'_title'"
                                       placeholder="Chọn điểm dự thi" [filter]="true"
                                       [filterBy]="'_title'" optionId="diemduthi_id" [formField]="f['diemduthi_id']"
                                       (onChange)="selectDiemduthi($event)"
                        ></ovic-dropdown>
                      </div>
                    </div>

                  </div>

                </form>
              </div>

              <div class="body" *ngIf="this.kehoach_select && this.kehoach_diemduthi_select">
                <div class="info">
                  <div><strong>Đợt thi:</strong> {{kehoach_select.title}}</div>
                  <div><strong>Thời gian đăng ký:</strong> {{kehoach_select['_date_convertd']}}</div>
                  <div><strong>Điểm dự thi:</strong> {{kehoach_diemduthi_select['_diemduthi'] ? kehoach_diemduthi_select['_diemduthi'].title : '' }}</div>
                  <div><strong>Số lượng đăng ký : </strong> <span class="count err">{{ kehoach_diemduthi_select['_soluongByDiemduthi'] }}</span></div>
                  <div><strong>Giá: </strong> <span class="count">{{kehoach_select.gia | numberToVndCurrencuy}}</span></div>
                </div>
              </div>
            </div>


            <div style="padding: 15px 0 ;display: flex;justify-content: center;gap: 10px;">

                <button pButton pRipple class="p-button-success" icon="pi pi-check-square" label="Đăng ký dự thi"
                        [loading]="isLoading"
                        (click)="SaveForm()"></button>

              <button pButton pRipple icon="pi pi-user-edit" label="Cập nhật thông tin" (click)="btnRouInfo()"></button>
            </div>
            <div class="row">
              <div class="col-12 ovic-ui-table" [class.ovic-is-loading]="isLoading">
                <div class="ovic-load-init-fail alert alert-danger --fs-14" *ngIf="loadInitFail; else tableData">
                  Đã có lỗi trong quá trình tải dữ liệu
                  <button class="btn btn-primary border-circle --fs-13 ml-2" (click)="loadInit()">Reload</button>
                </div>
                <ng-template #tableData>
                  <div class="p-datatable-header" style="border-bottom:1px solid #CCC;">
                    <h3 class="tbl-title "> Danh sách đăng ký thi </h3>
                  </div>
                  <p-table [value]="dataOrders" [showCurrentPageReport]="false" [rowHover]="true"
                           [tableStyle]="{ 'min-width': '100px' }">
                    <ng-template pTemplate="header">
                      <tr>
                        <th class="ovic-w-50px text-center">TT</th>
                        <th class="ovic-w-100px text-center">Mã đăng ký</th>
                        <th class="text-left">Đợt thi</th>
                        <th class=" text-left text-center">Điểm dự thi</th>
                        <th class="ovic-w-180px text-center">Lệ phí thi</th>
                        <th class="ovic-w-110px text-center">Trạng thái</th>
                        <th class="ovic-w-180px text-center">Thao tác</th>
                      </tr>
                    </ng-template>
                    <ng-template pTemplate="emptymessage">
                      <tr>
                        <td colspan="7">Không có dữ liệu</td>
                      </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-item>
                      <tr>
                        <td class="ovic-w-50px text-center" [innerHTML]="item['_indexTable']"></td>
                        <td class="ovic-w-50px text-center" >VSTEP {{ item['id'] }}</td>
                        <td>
                          <div class="d-block --fs-14 font-weight-bold" [innerHTML]="item['__kehoach_thi']"></div>
                        </td>
                        <td class="ovic-w-260px">
                          <div class="d-block --fs-14 " [innerHTML]="item['__diemduthi_covered']"></div>

                        </td>
                        <td class="ovic-w-100px">
                          <div class="d-block --fs-14 text-right"
                               [innerHTML]="item['__lephithi_covered' ] |numberToVndCurrencuy"></div>
                        </td>
                        <td class="ovic-w-150px">
                          <div class="d-block --fs-14" [innerHTML]="item['__status_converted'] | htmlDecode"></div>
                        </td>
                        <td class="ovic-w-180px text-center">


                          <ng-container *ngIf="item['__have_parent'] else notParent">
                            <div class="d-flex flex-column " style="gap:6px;">
                              <div class="view-chuy">
                                {{ item['__ghichu'] }}
                              </div>
                            </div>
                          </ng-container>
                          <ng-template #notParent>
                            <ng-container *ngIf="item['__trangthai_thanhtoan'] === 1 else notParentNotPay">
                              <div class="d-flex flex-column " style="gap:6px;">

                                <ng-container *ngIf="item['__kehoach_thi']['__kehoach_thi_status'] !==0">

                                  <div class="is_huy" *ngIf=" item['huy']">
                                    Bạn đã hủy dự thi
                                  </div>
                                </ng-container>

                              </div>
                            </ng-container>
                            <ng-template #notParentNotPay>
                              <div class="d-flex flex-wrap justify-content-center" style=" gap: 10px;">
                                <button pButton pRipple class="p-button-warning mx-1" [pTooltip]="'Thanh toán'"
                                        [tooltipPosition]="'top'" icon="pi pi-credit-card" [loading]="isLoading"
                                        (click)="getPayment(item)"></button>
                                <button pButton pRipple class="p-button-danger mx-1"
                                        [pTooltip]="'Xoá'" [tooltipPosition]="'top'" icon="pi pi-trash"
                                        (click)="deleteRow(item)"></button>
                              </div>
                            </ng-template>
                          </ng-template>

                          <!--              </div>-->
                        </td>
                      </tr>
                    </ng-template>
                  </p-table>

                  <p-paginator [rows]="limit" [totalRecords]="recordTotal" (onPageChange)="paginate($event)"></p-paginator>
                </ng-template>
              </div>
            </div>
          </div>

        </div>
      </div>

    </ng-container>
  </ng-container>
</ng-container>

<ng-template #notStatus>
  <div class="w-100 d-flex justify-content-center align-items-center flex-column" style="height:calc(100vh - 90px)">
    <div>
      <i class="pi pi-exclamation-circle py-3" style="font-size: 8rem;color:#f59e0b"></i>
    </div>
    <div class="p-3" style="font-size: 17px;">Bạn chưa hoàn thành cập nhật thông tin!</div>
    <div>
      <button pButton pRipple class="p-button-warning p-button-text" label="Cập nhật thông tin cá nhân"
              style="font-size:16px;"
              (click)="returnInfo()"></button>
    </div>

  </div>
</ng-template>


